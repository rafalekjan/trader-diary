{% extends "base.html" %}
{% block title %}Score{% endblock %}
{% block content %}
<div class="page-header">
    <div>
        <h2>Score</h2>
        <p class="page-subtitle">SPY (1D) Market Gatekeeper: direction, regime, location, risk, and market permission.</p>
    </div>
</div>

<form id="score-form" class="card analysis-builder scoring-builder" autocomplete="off">
    <div class="analysis-section">
        <div class="scoring-header-row">
            <h3>SPY (1D) - Market Gatekeeper</h3>
            <div class="scoring-header-summary">
                <div><strong>Market Score:</strong> <span id="score-market-score">0 / 100</span></div>
                <div><strong>Permission:</strong> <span id="score-market-permission">No data</span></div>
                <div><strong>Risk State:</strong> <span id="score-risk-state">No data</span></div>
                <div><strong>Size:</strong> <span id="score-size-modifier">-</span></div>
            </div>
        </div>

        <div class="analysis-subsection">
            <h4>A. Regime & Direction</h4>
            <div class="scoring-stage-grid">
                <div class="form-group">
                    <label>Market Regime <span class="help-icon" data-tooltip="Trend = HH/HL lub LL/LH + nachylone MA. Range = overlap świec + płaskie MA. Volatile = duże świece/ATR% wysokie, częste zwroty. Reżim steruje tym, czy swing ma edge.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_regime" value="trend_up"><span class="checkbox-text">Trend Up</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_regime" value="trend_down"><span class="checkbox-text">Trend Down</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_regime" value="range"><span class="checkbox-text">Range</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_regime" value="volatile"><span class="checkbox-text">Volatile-Unstable</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Bias <span class="help-icon" data-tooltip="Preferowany kierunek zagrań na akcjach. Nie 'co może', tylko 'co ma statystycznie sens' w tym reżimie.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_bias" value="bullish"><span class="checkbox-text">Bullish</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_bias" value="bearish"><span class="checkbox-text">Bearish</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_bias" value="neutral"><span class="checkbox-text">Neutral</span></label>
                    </div>
                    <label class="checkbox-label" style="margin-top:8px;">
                        <input type="checkbox" name="score_spy_bias_manual_override">
                        <span class="checkbox-text">Manual override</span>
                    </label>
                    <div id="score-bias-auto" class="scoring-readonly-value">Auto bias: No data</div>
                </div>
                <div class="form-group">
                    <label>Structure <span class="help-icon" data-tooltip="Układ swingów na D1: HH/HL (bull), LL/LH (bear), Mixed/Range (ostrożnie).">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_structure" value="hh_hl"><span class="checkbox-text">HH/HL</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_structure" value="ll_lh"><span class="checkbox-text">LL/LH</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_structure" value="mixed"><span class="checkbox-text">Mixed</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_structure" value="range"><span class="checkbox-text">Range</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Trend Strength <span class="help-icon" data-tooltip="Położenie vs 20EMA/50MA/200SMA jako filtr reżimu: powyżej = long-friendly, poniżej = short-friendly, wokół = ostrożność.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_trend_strength" value="above_key_mas"><span class="checkbox-text">Above key MAs</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_trend_strength" value="below_key_mas"><span class="checkbox-text">Below key MAs</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_trend_strength" value="chop_around_mas"><span class="checkbox-text">Chop around MAs</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>VWAP (optional) <span class="help-icon" data-tooltip="Na 1D to dodatkowy kontekst, nie filar decyzji kierunkowej.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_vwap" value="above"><span class="checkbox-text">Above</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_vwap" value="below"><span class="checkbox-text">Below</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_vwap" value="na"><span class="checkbox-text">N/A</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Momentum Condition (1D) <span class="help-icon" data-tooltip="Expanding: range rośnie i zamknięcia wspierają kierunek; Stable: trend trwa bez przyspieszenia; Diverging: cena idzie dalej, ale momentum nie potwierdza; Exhausted: po długim ruchu impet gaśnie i rośnie ryzyko mean reversion.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_momentum_condition" value="expanding"><span class="checkbox-text">Expanding</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_momentum_condition" value="stable"><span class="checkbox-text">Stable</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_momentum_condition" value="diverging"><span class="checkbox-text">Diverging</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_momentum_condition" value="exhausted"><span class="checkbox-text">Exhausted</span></label>
                    </div>
                </div>
            </div>
            <div id="score-inconsistency" class="scoring-guardrail"></div>
        </div>

        <div class="analysis-subsection score-section-b">
            <h4>B. Location & Blocks</h4>
            <div class="scoring-stage-grid">
                <div class="form-group">
                    <label>Location <span class="help-icon" data-tooltip="Gdzie jest cena względem leveli: edge (wsparcie/opór) daje plan; środek range = brak przewagi.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_location" value="at_support"><span class="checkbox-text">At Support</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_location" value="at_resistance"><span class="checkbox-text">At Resistance</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_location" value="middle_of_range"><span class="checkbox-text">Middle of Range</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_location" value="breakout_attempt"><span class="checkbox-text">Breakout Attempt</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_location" value="breakdown_attempt"><span class="checkbox-text">Breakdown Attempt</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_location" value="post_break_retest"><span class="checkbox-text">Post-break Retest</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Support status <span class="help-icon" data-tooltip="Stan poziomu: Holding / Broken / Reclaimed / Rejecting / Not tested.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_support_status" value="holding"><span class="checkbox-text">Holding</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_support_status" value="broken"><span class="checkbox-text">Broken</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_support_status" value="reclaimed"><span class="checkbox-text">Reclaimed</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_support_status" value="rejecting"><span class="checkbox-text">Rejecting</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_support_status" value="not_tested"><span class="checkbox-text">Not tested</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Resistance status <span class="help-icon" data-tooltip="Stan poziomu: Holding / Broken / Reclaimed / Rejecting / Not tested.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_resistance_status" value="holding"><span class="checkbox-text">Holding</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_resistance_status" value="broken"><span class="checkbox-text">Broken</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_resistance_status" value="reclaimed"><span class="checkbox-text">Reclaimed</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_resistance_status" value="rejecting"><span class="checkbox-text">Rejecting</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_resistance_status" value="not_tested"><span class="checkbox-text">Not tested</span></label>
                    </div>
                </div>
                <div class="form-group score-b-room-to-move">
                    <label>Room to Move <span class="help-icon" data-tooltip="Ile miejsca jest do kolejnego poziomu. Małe room = słaby R/R dla swing.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_room_to_move" value="large"><span class="checkbox-text">Large</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_room_to_move" value="medium"><span class="checkbox-text">Medium</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_room_to_move" value="limited"><span class="checkbox-text">Limited</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_room_to_move" value="none"><span class="checkbox-text">None</span></label>
                    </div>
                    <label class="checkbox-label" style="margin-top:8px;">
                        <input type="checkbox" name="score_spy_room_manual_override">
                        <span class="checkbox-text">Manual override</span>
                    </label>
                    <div id="score-room-effective" class="scoring-readonly-value">Auto room: No data | Effective: No data</div>
                </div>
                <div class="form-group score-b-key-levels">
                    <label>Key Levels <span class="help-icon" data-tooltip="Major swing levels (1D/weekly): PDH/PDL, PWH/PWL, swing high/low, 20/50/200. Nie uzywaj intraday mikro-poziomow. Te poziomy definiuja room i invalidation.">?</span></label>
                    <div class="timeframe-row-2cols">
                        <input id="score_spy_key_support" name="score_spy_key_support" type="text" placeholder="Support">
                        <input id="score_spy_key_resistance" name="score_spy_key_resistance" type="text" placeholder="Resistance">
                    </div>
                </div>
                <div class="form-group score-b-manual-values">
                    <label>Manual values <span class="help-icon" data-tooltip="Wpisz dokladnie wartosci: Close i ATR(14) z tabeli TV.">?</span></label>
                    <div class="timeframe-row-2cols">
                        <input name="score_spy_manual_close" type="text" placeholder="Close">
                        <input name="score_spy_manual_atr" type="text" placeholder="ATR (14)">
                    </div>
                </div>
            </div>
        </div>

        <div class="analysis-subsection">
            <h4>C. Risk Conditions</h4>
            <div class="scoring-stage-grid">
                <div class="form-group">
                    <label>VIX Level <span class="help-icon" data-tooltip="VIX wysoki i rosnący = większe ryzyko whipsaw; niski i spadający = stabilniej.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_vix_level" value="lt20"><span class="checkbox-text">&lt;20</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_vix_level" value="20_25"><span class="checkbox-text">20-25</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_vix_level" value="gt25"><span class="checkbox-text">&gt;25</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>VIX Trend <span class="help-icon" data-tooltip="Rising VIX zwykle pogarsza warunki dla spokojnych swingów; falling VIX sprzyja stabilniejszym trendom.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_vix_trend" value="rising"><span class="checkbox-text">Rising</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_vix_trend" value="falling"><span class="checkbox-text">Falling</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_vix_trend" value="flat"><span class="checkbox-text">Flat</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>ATR% Environment <span class="help-icon" data-tooltip="ATR% = typowa dzienna zmienność. Urealnia stop i targety.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_atr_env" value="low"><span class="checkbox-text">Low</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_atr_env" value="normal"><span class="checkbox-text">Normal</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_atr_env" value="high"><span class="checkbox-text">High</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Breadth <span class="help-icon" data-tooltip="Breadth = czy rynek niesie wiele spółek czy tylko kilka. Słaby breadth = większe ryzyko fałszywych ruchów.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_spy_breadth" value="strong"><span class="checkbox-text">Strong</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_breadth" value="neutral"><span class="checkbox-text">Neutral</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_spy_breadth" value="weak"><span class="checkbox-text">Weak</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>QQQ vs 200SMA</label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_qqq_200_state" value="above"><span class="checkbox-text">Above</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_qqq_200_state" value="below"><span class="checkbox-text">Below</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_qqq_200_state" value="na"><span class="checkbox-text">N/A</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Event Risk <span class="help-icon" data-tooltip="Dni eventowe zwiększają ryzyko skoków i odwróceń. Swing options: mniejszy size albo czekanie po evencie.">?</span></label>
                    <div class="checkbox-group scoring-option-grid scoring-option-grid-2">
                        <label class="checkbox-label"><input type="checkbox" name="score_spy_event_cpi"><span class="checkbox-text">CPI</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="score_spy_event_fomc"><span class="checkbox-text">FOMC</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="score_spy_event_nfp"><span class="checkbox-text">NFP</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="score_spy_event_opex"><span class="checkbox-text">OPEX</span></label>
                        <label class="checkbox-label"><input type="checkbox" name="score_spy_event_earnings_heavy"><span class="checkbox-text">Earnings-heavy day</span></label>
                    </div>
                </div>
            </div>
        </div>

        <div class="analysis-subsection">
            <h4>Output</h4>
            <div class="scoring-stage-grid">
                <div class="form-group">
                    <label>Market Permission (auto)</label>
                    <div id="score-market-permission-box" class="scoring-readonly-value">No data</div>
                </div>
                <div class="form-group">
                    <label>Risk State (auto)</label>
                    <div id="score-risk-state-box" class="scoring-readonly-value">No data</div>
                </div>
                <div class="form-group">
                    <label>Size Modifier (auto)</label>
                    <div id="score-size-modifier-box" class="scoring-readonly-value">-</div>
                </div>
                <div class="form-group">
                    <label>Breakdown</label>
                    <div id="score-breakdown" class="scoring-readonly-value">A: 0/40 | B: 0/35 | C: 0/25</div>
                </div>
                <div class="form-group">
                    <label>Edge Type</label>
                    <div id="score-edge-type-box" class="scoring-readonly-value">No data</div>
                </div>
                <div class="form-group">
                    <label>Summary</label>
                    <div id="score-summary" class="scoring-readonly-value">Fill fields to evaluate market gatekeeper.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="analysis-section">
        <div class="scoring-header-row">
            <h3>Ticker (1D) - Direction &amp; Context</h3>
            <div class="scoring-header-summary">
                <div><strong>Ticker Score:</strong> <span id="score-stk1d-score-head">No data</span></div>
                <div><strong>Permission:</strong> <span id="score-stk1d-permission-head">No data</span></div>
            </div>
        </div>
        <div class="analysis-subsection">
            <h4>Ticker (1D) - Direction &amp; Context</h4>
            <div class="scoring-stage-grid stock1d-layout">
                <div class="form-group">
                    <label for="score_stk1d_ticker">Ticker <span class="help-icon" data-tooltip="Symbol akcji analizowanej na interwale 1D.">?</span></label>
                    <input id="score_stk1d_ticker" name="score_stk1d_ticker" type="text" placeholder="NVDA">
                </div>
                <div class="form-group">
                    <label>Market Regime <span class="help-icon" data-tooltip="Trend = HH/HL lub LL/LH + nachylone MA. Range = overlap świec + płaskie MA. Volatile = duże świece/ATR% wysokie, częste zwroty.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_regime" value="trend_up"><span class="checkbox-text">Trend Up</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_regime" value="trend_down"><span class="checkbox-text">Trend Down</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_regime" value="range"><span class="checkbox-text">Range</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_regime" value="volatile"><span class="checkbox-text">Volatile</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Bias <span class="help-icon" data-tooltip="Preferowany kierunek zagrań na tickerze. Domyślnie liczony automatycznie z Regime + Structure + Trend Strength + Momentum.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_bias" value="bullish"><span class="checkbox-text">Bullish</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_bias" value="bearish"><span class="checkbox-text">Bearish</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_bias" value="neutral"><span class="checkbox-text">Neutral</span></label>
                    </div>
                    <label class="checkbox-label" style="margin-top:8px;">
                        <input type="checkbox" name="score_stk1d_bias_manual_override">
                        <span class="checkbox-text">Manual override</span>
                    </label>
                    <div id="score-stk1d-bias-auto" class="scoring-readonly-value">Auto bias: No data</div>
                </div>
                <div class="form-group">
                    <label>Structure <span class="help-icon" data-tooltip="Układ swingów na D1: HH/HL (bull), LL/LH (bear), Mixed/Range (ostrożnie).">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_structure" value="hh_hl"><span class="checkbox-text">HH/HL</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_structure" value="ll_lh"><span class="checkbox-text">LL/LH</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_structure" value="mixed"><span class="checkbox-text">Mixed</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_structure" value="range"><span class="checkbox-text">Range</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Trend Strength <span class="help-icon" data-tooltip="Położenie vs 20EMA/50MA/200SMA: powyżej = long-friendly, poniżej = short-friendly, wokół = chop/ostrożność.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_trend_strength" value="above_key_mas"><span class="checkbox-text">Above key MAs</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_trend_strength" value="below_key_mas"><span class="checkbox-text">Below key MAs</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_trend_strength" value="chop_around_mas"><span class="checkbox-text">Chop around MAs</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>VWAP (optional) <span class="help-icon" data-tooltip="Na 1D to dodatkowy kontekst, nie filar decyzji kierunkowej.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_vwap" value="above"><span class="checkbox-text">Above</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_vwap" value="below"><span class="checkbox-text">Below</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_vwap" value="na"><span class="checkbox-text">N/A</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Momentum Condition (1D) <span class="help-icon" data-tooltip="Expanding = impet rośnie; Stable = trend trwa; Diverging = impet nie potwierdza ceny; Exhausted = rośnie ryzyko cofnięcia.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_momentum" value="expanding"><span class="checkbox-text">Expanding</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_momentum" value="stable"><span class="checkbox-text">Stable</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_momentum" value="diverging"><span class="checkbox-text">Diverging</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_momentum" value="exhausted"><span class="checkbox-text">Exhausted</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Market Alignment (vs SPY) <span class="help-icon" data-tooltip="Aligned/Mixed/Contra: zgodność tickera z kierunkiem SPY.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_alignment" value="aligned"><span class="checkbox-text">Aligned</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_alignment" value="mixed"><span class="checkbox-text">Mixed</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_alignment" value="contra"><span class="checkbox-text">Contra</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>RS state vs SPY <span class="help-icon" data-tooltip="Relative strength względem SPY: Strong/Neutral/Weak.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_rs_state" value="strong"><span class="checkbox-text">Strong</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_rs_state" value="neutral"><span class="checkbox-text">Neutral</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_rs_state" value="weak"><span class="checkbox-text">Weak</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>RS trend <span class="help-icon" data-tooltip="Kierunek RS vs SPY: rising/flat/falling.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_rs_trend" value="rising"><span class="checkbox-text">Rising</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_rs_trend" value="flat"><span class="checkbox-text">Flat</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_rs_trend" value="falling"><span class="checkbox-text">Falling</span></label>
                    </div>
                </div>
                <div class="form-group stk1d-manual-values">
                    <label>Manual values <span class="help-icon" data-tooltip="Wpisz dokladnie wartosci: Close i ATR(14) z tabeli TV.">?</span></label>
                    <div class="timeframe-row-2cols">
                        <input name="score_stk1d_close" type="text" placeholder="Close">
                        <input name="score_stk1d_atr" type="text" placeholder="ATR (14)">
                    </div>
                </div>
                <div class="form-group stk1d-key-levels">
                    <label>Key Levels <span class="help-icon" data-tooltip="Major swing levels (1D/weekly): PDH/PDL, PWH/PWL, swing high/low, 20/50/200. Nie uzywaj intraday mikro-poziomow. Te poziomy definiuja room i invalidation.">?</span></label>
                    <div class="timeframe-row-2cols">
                        <input name="score_stk1d_support" type="text" placeholder="Support">
                        <input name="score_stk1d_resistance" type="text" placeholder="Resistance">
                    </div>
                </div>
                <div class="form-group stk1d-room-to-move">
                    <label>Room to Move <span class="help-icon" data-tooltip="Ile miejsca jest do kolejnego poziomu. Male room = slaby R/R dla swing.">?</span></label>
                    <div class="checkbox-group scoring-option-grid">
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_room_to_move" value="large"><span class="checkbox-text">Large</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_room_to_move" value="medium"><span class="checkbox-text">Medium</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_room_to_move" value="limited"><span class="checkbox-text">Limited</span></label>
                        <label class="checkbox-label"><input type="radio" name="score_stk1d_room_to_move" value="none"><span class="checkbox-text">None</span></label>
                    </div>
                    <label class="checkbox-label" style="margin-top:8px;">
                        <input type="checkbox" name="score_stk1d_room_manual_override">
                        <span class="checkbox-text">Manual override</span>
                    </label>
                    <div id="score-stk1d-room-effective" class="scoring-readonly-value">Auto room: No data | Effective: No data</div>
                </div>
                <div class="form-group stk1d-permission-box">
                    <label>Ticker Permission (auto) <span class="help-icon" data-tooltip="Automatyczna decyzja dla tickera: Allowed / Reduced / No-trade.">?</span></label>
                    <div id="score-stk1d-permission" class="scoring-readonly-value">No data</div>
                </div>
                <div class="form-group stk1d-invalidation-box">
                    <label>Invalidation tomorrow (auto) <span class="help-icon" data-tooltip="Warunek unieważnienia setupu na kolejnej sesji (kontekst 1D).">?</span></label>
                    <div id="score-stk1d-invalidation" class="scoring-readonly-value">No data</div>
                </div>
            </div>
        </div>
    </div>

        <div class="analysis-section">
        <div class="scoring-header-row">
            <h3>Ticker (4H) - Structure &amp; Planning</h3>
            <div class="scoring-header-summary">
                <div><strong>4H Score:</strong> <span id="score-stk4h-score-head">No data</span></div>
                <div><strong>Grade:</strong> <span id="score-stk4h-grade-head">No data</span></div>
                <div><strong>Status:</strong> <span id="score-stk4h-status-head">No data</span></div>
            </div>
        </div>
        <div class="analysis-subsection">
            <h4>Ticker (4H) - Structure &amp; Planning</h4>
            <div class="scoring-stage-grid">
                <div class="form-group">
                    <label>Part 1 (AUTO from PINE)</label>
                    <div class="scoring-readonly-value">Wpisz fakty z tabeli Pine 4H (AUTO/HINT).</div>
                </div>
                <div class="form-group">
                    <label>Bias vs 1D (hint)</label>
                    <select name="score_stk4h_bias_vs_1d_hint">
                        <option value="">Select</option>
                        <option value="in_direction_1d">In direction of 1D</option>
                        <option value="counter_trend">Counter-trend</option>
                        <option value="neutral">Neutral</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bias 1D (auto)</label>
                    <select name="score_stk4h_bias_1d_auto">
                        <option value="">Select</option>
                        <option value="bullish">Bullish</option>
                        <option value="bearish">Bearish</option>
                        <option value="neutral">Neutral</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bias 4H (auto)</label>
                    <select name="score_stk4h_bias_4h_auto">
                        <option value="">Select</option>
                        <option value="bullish">Bullish</option>
                        <option value="bearish">Bearish</option>
                        <option value="neutral">Neutral</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>4H Structure (auto)</label>
                    <select name="score_stk4h_structure_auto">
                        <option value="">Select</option>
                        <option value="hh_hl">HH/HL</option>
                        <option value="ll_lh">LL/LH</option>
                        <option value="compression">Compression</option>
                        <option value="range">Range</option>
                        <option value="transition">Transition</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Trend Strength (auto)</label>
                    <select name="score_stk4h_trend_strength_auto">
                        <option value="">Select</option>
                        <option value="above_key_mas">Above key MAs</option>
                        <option value="below_key_mas">Below key MAs</option>
                        <option value="chop_around_mas">Chop around MAs</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Trend Quality (auto)</label>
                    <select name="score_stk4h_trend_quality_auto">
                        <option value="">Select</option>
                        <option value="clean_trend">Clean trend</option>
                        <option value="overlapping_messy">Overlapping / messy</option>
                        <option value="exhausted">Exhausted</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Regime (auto)</label>
                    <select name="score_stk4h_regime_auto">
                        <option value="">Select</option>
                        <option value="trend_up">Trend Up</option>
                        <option value="trend_down">Trend Down</option>
                        <option value="range">Range</option>
                        <option value="volatile">Volatile</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>VWAP state (auto)</label>
                    <select name="score_stk4h_vwap_state_auto">
                        <option value="">Select</option>
                        <option value="above">Above</option>
                        <option value="below">Below</option>
                        <option value="around">Around</option>
                        <option value="na">N/A</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location (hint)</label>
                    <select name="score_stk4h_location_hint">
                        <option value="">Select</option>
                        <option value="at_4h_support">At 4H support</option>
                        <option value="at_4h_resistance">At 4H resistance</option>
                        <option value="at_htf_level">At HTF level (1D)</option>
                        <option value="middle_of_structure">Middle of structure</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Liquidity hint</label>
                    <select name="score_stk4h_liquidity_hint">
                        <option value="">Select</option>
                        <option value="sweep_low">Sweep of low</option>
                        <option value="sweep_high">Sweep of high</option>
                        <option value="inside_bar_compression">Inside bar compression</option>
                        <option value="none">None</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>AUTO values (from Pine)</label>
                    <div class="timeframe-row-2cols">
                        <input name="score_stk4h_close" type="text" placeholder="Close">
                        <input name="score_stk4h_atr14" type="text" placeholder="ATR(14)">
                    </div>
                    <div class="timeframe-row-2cols" style="margin-top:6px;">
                        <input name="score_stk4h_support_auto" type="text" placeholder="Support (auto)">
                        <input name="score_stk4h_resistance_auto" type="text" placeholder="Resistance (auto)">
                    </div>
                    <div class="timeframe-row-2cols" style="margin-top:6px;">
                        <input name="score_stk4h_pwh" type="text" placeholder="PWH (optional)">
                        <input name="score_stk4h_pwl" type="text" placeholder="PWL (optional)">
                    </div>
                </div>
                <div class="form-group">
                    <label>Part 2 (PLAN)</label>
                    <div class="scoring-readonly-value">Manual plan: setup, confirmation, invalidation, risk levels.</div>
                </div>
                <div class="form-group">
                    <label>Setup Type (required)</label>
                    <select name="score_stk4h_setup_type">
                        <option value="">Select</option>
                        <option value="pullback_continuation">Pullback continuation</option>
                        <option value="breakout_continuation">Breakout continuation</option>
                        <option value="range_play">Range play</option>
                        <option value="breakdown_continuation">Breakdown continuation</option>
                        <option value="reversal_attempt">Reversal attempt</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Confirmation condition (required)</label>
                    <select name="score_stk4h_confirmation">
                        <option value="">Select</option>
                        <option value="close_above_level">4H close above level</option>
                        <option value="strong_bull_candle">Strong bull candle</option>
                        <option value="reclaim_level">Reclaim level</option>
                        <option value="break_hold">Break + hold</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Invalidation logic (required)</label>
                    <select name="score_stk4h_invalidation_logic">
                        <option value="">Select</option>
                        <option value="below_last_hl">Below last HL</option>
                        <option value="above_last_lh">Above last LH</option>
                        <option value="below_4h_support">Below 4H support</option>
                        <option value="above_4h_resistance">Above 4H resistance</option>
                        <option value="close_back_inside_range">Close back inside range</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Risk Levels</label>
                    <div class="timeframe-row-3cols">
                        <input name="score_stk4h_entry" type="text" placeholder="Entry">
                        <input name="score_stk4h_stop" type="text" placeholder="Stop">
                        <input name="score_stk4h_target" type="text" placeholder="Target">
                    </div>
                </div>
                <div class="form-group">
                    <label>Output</label>
                    <div id="score-stk4h-rr" class="scoring-readonly-value">R:R: No data</div>
                    <div id="score-stk4h-room" class="scoring-readonly-value">Room: No data</div>
                    <div id="score-stk4h-breakdown" class="scoring-readonly-value">Structure: 0/8 | Setup: 0/6 | Risk: 0/6 | Penalties: 0</div>
                    <div id="score-stk4h-status" class="scoring-readonly-value">Status: No data</div>
                    <div id="score-stk4h-warnings" class="scoring-readonly-value">Warnings: none</div>
                </div>
            </div>
        </div>
    </div>

    <div class="analysis-section">
        <div class="scoring-header-row">
            <h3>History</h3>
            <div class="scoring-header-summary">
                <div><a class="btn btn-secondary" href="/score/snapshots/export.csv">Export CSV</a></div>
            </div>
        </div>
        <div class="scoring-stage-grid">
            <div class="form-group">
                <label for="score-session-date">Session date</label>
                <input id="score-session-date" name="score_session_date" type="date">
            </div>
            <div class="form-group">
                <label>&nbsp;</label>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="score-save-snapshot">Save snapshot</button>
                    <button type="button" class="btn btn-secondary" id="score-refresh-history">Refresh</button>
                </div>
            </div>
            <div class="form-group">
                <label>Status</label>
                <div id="score-history-status" class="scoring-readonly-value">No snapshot saved yet.</div>
            </div>
        </div>
        <div class="table-wrap">
            <table class="score-result-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Total (All Sectors)</th>
                        <th>Sector Breakdown</th>
                        <th>Size</th>
                        <th>Risk State</th>
                        <th>Load</th>
                    </tr>
                </thead>
                <tbody id="score-history-body">
                    <tr><td colspan="6">No data</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</form>
{% endblock %}



